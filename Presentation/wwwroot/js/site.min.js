function RESTCALL(n,t,i,r,u,f,e,o,s){$.ajax({xhr:function(){enablespiner();var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){if($(".progress").show(),n.lengthComputable){var t=n.loaded/n.total;t=parseInt(t*100);$(".progress-bar").css("width",t+"%");$(".progress-bar").text(t+"%");t===100&&($(".progress").hide(),$(".progress-bar").css("width","0%"))}},!1),n},url:n,type:i,cache:!0,data:t,processData:u,enctype:s,contentType:r,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val());(o!=""||o!=undefined)&&n.setRequestHeader("Authorization","Bearer "+o)},success:f,error:e})}function removefile(n){var i=n.target.name.trim(),t;if(selectedFile!=null){for(t=0;t<selectedFile.length;t++)if(selectedFile[t].name==i){selectedFile.splice(t,1);break}n.currentTarget.parentNode.remove()}}function ConvertDatetoString(n){var t=n.getMonth()+1,i=n.getDate();return t=t<10?0+t.toString():t,i=i<10?0+i.toString():i,n.getFullYear()+"-"+t+"-"+i}function enablespiner(n="Processing"){$(".progress").length==0&&(msg=alertify.message("<div class='progress' style='margin-bottom:10px;display:none'><div class='progress-bar' style='width:0%' role='progressbar' aria-valuemin='0' aria-valuemax='100'><\/div><\/div><div style='display:-webkit-box'>"+n+"&nbsp;<i style = 'display:block;' class= 'fas fa-circle-notch fa-2x fa-spin' ><\/i><\/div>",0))}function disablespinner(){$(".progress").length!=0&&msg.dismiss()}function EnableReqInput(){var n="#"+$("#type-select").val(),t=$("#type-select > option").each(function(t){var i="#"+$("#type-select > option")[t].value;n!=i&&($(i).hide(),$(i+' :input[type="number"]').each(function(n){$(i+' :input[type="number"]')[n].disabled=!0}),$(i+" select").each(function(n){$(i+" select")[n].disabled=!0}))});n=="#Yearly"&&$(n+" :input").each(function(t){$(n+" :input")[t].disabled=!1});$(n).show();$('input[name="sub-radio"]').each(function(n){var t;$('input[name="sub-radio"]')[n].checked?(t="."+$('input[name="sub-radio"]')[n].id,$(t+" :input").each(function(n){$(t+" :input")[n].disabled=!1}),$(t+" select").each(function(n){$(t+" select")[n].disabled=!1})):(t="."+$('input[name="sub-radio"]')[n].id,$(t+" :input").each(function(n){$(t+" :input")[n].disabled=!0}),$(t+" select").each(function(n){$(t+" select")[n].disabled=!0}))})}function EndInputEnabler(){$('input[name="end-select"]').each(function(n){var t;$('input[name="end-select"]')[n].checked?(t="."+$('input[name="end-select"]')[n].id,$(t+" :input").each(function(n){$(t+" :input")[n].disabled=!1})):(t="."+$('input[name="end-select"]')[n].id,$(t+" :input").each(function(n){$(t+" :input")[n].disabled=!0}))})}function GenarateCron(){var n="*1 *2 *3 *4 *5",t,i,u,r,f;if(n=n.replace("*1","0").replace("*2","0"),$('input[name="type-select"]:checked').val()=="Daily"||$("#type-select").val()=="Daily")$('input[name="sub-radio"]:checked').val()=="Every"?(i=$("#daily-occurence").val()!=""?"*/"+$("#daily-occurence").val():"*",n=n.replace("*3",i)):$('input[name="sub-radio"]:checked').val()=="Weekdays"&&(n=n.replace("*5","2-6"));else if($('input[name="type-select"]:checked').val()=="Weekly"||$("#type-select").val()=="Weekly")t="",$.each($("input[name='exampleCheck1']:checked"),function(){t=t+$(this).val()+","}),t=t.substr(0,t.length-1),t==""&&(t="1"),n=n.replace("*5",t);else if($('input[name="type-select"]:checked').val()=="Monthly"||$("#type-select").val()=="Monthly"){if($('input[name="sub-radio"]:checked').val()=="Day")i=$("#month").val()!=""?"*/"+$("#month").val():"*",u=$("#day").val()!=""?$("#day").val():"*",n=n.replace("*3",u).replace("*4",i);else if($('input[name="sub-radio"]:checked').val()=="Month"){r=$("#select-day-option").val();$("#select-day-option").val()=="L"&&(f=[1,3,5,7,8,10,12],r=f.indexOf($("#input-month").val())!=-1?31:$("#input-month").val()==2?28:30);var i=r!="L"&&r!=""?r:"*",u=$("#select-week-option").val()!=""?$("#select-week-option").val():"*",e=$("#input-month").val()!=""?"*/"+$("#input-month").val():"*";n=n.replace("*3",i).replace("*4",e).replace("*5",u)}}else($('input[name="type-select"]:checked').val()=="Yearly"||$("#type-select").val()=="Yearly")&&($("#year-day").val()!=""&&$("#year-day").val()!=undefined&&(n=n.replace("*3",$("#year-day").val())),$("#year-month").val()!=""&&$("#year-month").val()!=undefined&&(n=n.replace("*4",$("#year-month").val())));n=n.replace("*1","0").replace("*2","0").replace("*3","*").replace("*4","*").replace("*5","*");$("#CronExpression").val(n)}function AddItem(n){var t=$("#FilesRemoved").val();t==""||t==undefined?$("#FilesRemoved").val(n.target.name):$("#FilesRemoved").val(t+","+n.target.name);n.target.remove()}var file,selectedFile,d,datestring,arr,val,msg,isdownload;$(".select-mul").change(function(){$(".select-input").val($(this).val())});$(".Photo").change(function(n){const t=n.target.files[0];if(t!=undefined){const n=new FileReader;var i="";n.onload=n=>{i=n.target.result,$(".photo_disp img").prop("src",i)};n.readAsDataURL(t);$(".browsebutton")[0].innerText="Selected";$(".photo_disp").show()}});file=null;selectedFile=[];$(document).ready(function(){$(".File").change(function(n){if(file=n.target.files,file!=undefined){for(var t=0;t<file.length;t++){const n={maxSizeMB:1.6,maxWidthOrHeight:720,onProgress:Function,useWebWorker:!0};file[t].size/1024>3e3&&file[t].type.indexOf("image")!=-1?(enablespiner("Compressing"),imageCompression(file[t],n).then(function(n){var t=new File([n],n.name);selectedFile.push(t);disablespinner()})):selectedFile.push(file[t]);$("#file_selected").append("<span class='text-info'>&nbsp;"+file[t].name+"&nbsp; <input type='button' class='btn btn-sm btn-danger' onclick='removefile(event);' name='"+file[t].name+"' value='Delete'><br/><\/span>")}$("input[type=file]").replaceWith($("input[type=file]").val("").clone(!0))}})});$(".clear").click(function(){$("input[type=text]").val("")});d=new Date;datestring=ConvertDatetoString(d);$("#CreationEndDate").prop("max",datestring);$("#CreationStartDate").prop("max",datestring);($("#CreationEndDate").val()==""||$("#CreationEndDate").val()==undefined)&&$("#CreationEndDate").val(datestring);($("#DueDate").val()!=undefined||$("#DueDate").val()!="")&&$(".DueDatelabel").text($("#DueDate").val());$("#CreationEndDate").change(function(){$("#CreationStartDate").prop("max",$("#EndDate").val())});$('input[type="reset"]').click(function(){$(".wofilter :input").each(function(n){var t=$(".wofilter :input")[n];(t.type=="text"||t.type=="date")&&t.setAttribute("value","")});$(".mwofilter :input").each(function(n){var t=$(".mwofilter :input")[n];(t.type=="text"||t.type=="date")&&t.setAttribute("value","")});$("input[type=file]").replaceWith($("input[type=file]").val("").clone(!0));$("photo-display").prop("src","");$("#DueDate").prop("value","");selectedFile=[];$("#file_selected").load(location.href+" #file_selected>*","");$("input[type=checkbox]").prop("checked",!1);$(".photo_disp").hide();$("#Status").val("");$(".browsebutton")[0]!=undefined&&($(".browsebutton")[0].innerText="Browse");$("#Priority").val("");$(".primary_span").text("");$('input[type="submit"]').click()});arr=[];$('input[name$="SelectedProperty"]').on("change",function(){var n;$(this).prop("checked")==!0?(n=arr.lastIndexOf($(this).val()),n==-1&&arr.push($(this).val())):(n=arr.lastIndexOf($(this).val()),$('input[name$="PrimaryProperty"]:checked').val()==$(this).val()&&($(".primary_span").text(""),$('input[name$="PrimaryProperty"]:checked').prop("checked",!1)),arr.splice(n,1));$(".select-input").val(arr)});$('input[name$="PrimaryProperty"]').on("change",function(){var n=arr.lastIndexOf($(this).val());n==-1&&(arr.push($(this).val()),$(this).closest("div").find('input[type="checkbox"]').prop("checked",!0),$(".select-input").val(arr));$(".primary_span").text($(this).val())});$(".select-input").val()!=""&&$(".select-input").val()!=undefined&&(val=$(".select-input").val(),val.indexOf(",")!=-1?(val=val.split(","),arr=val):arr.push(val),$('input[name$="SelectedProperty"]').each(function(){arr.indexOf($(this).val())!=-1&&$(this).prop("checked",!0)}),$('input[name$="PrimaryProperty"]').each(function(){$(".primary_span").text().trim()==$(this).val()&&$(this).prop("checked",!0)}));msg=null;$(document).ready(function(){$("#adduser, #wocreate, #addprop, #wocreaterecurring").submit(function(n){var r,i,t;for(n.preventDefault(),$(this).is("#wocreaterecurring")&&GenarateCron(),r=$(this).attr("action"),i=new FormData(this),t=0;t<selectedFile.length;t++)i.append("File",selectedFile[t]);$(this).valid()&&($("form :input").prop("disabled",!0),RESTCALL(r,i,"POST",!1,!1,function(n){disablespinner();$("form :input").prop("disabled",!1);alertify.alert("Info","<p>"+n+"<\/p>",function(){$("input[type=reset]").click()})},function(n){disablespinner();$("input[type=password]").val("");$("form :input").prop("disabled",!1);var t=n.responseText.split("@");n.status==302&&alertify.alert("Success","<p>"+t[1]+"<\/p>",function(){window.location.href=t[0]})},""))})});$(document).ready(function(){$("#edituser, #editwo, #editworecurring").submit(function(n){var r,i,t;for(n.preventDefault(),$(this).is("#editworecurring")&&GenarateCron(),r=$(this).attr("action"),i=new FormData(this),t=0;t<selectedFile.length;t++)i.append("File",selectedFile[t]);$(this).valid()&&($("form :input").prop("disabled",!0),RESTCALL(r,i,"POST",!1,!1,function(n){disablespinner();$("form :input").prop("disabled",!1);alertify.alert("Info","<p>"+n+"<\/p>",function(){location.reload()})},function(n){disablespinner();$("input[type=password]").val("");$("form :input").prop("disabled",!1);alertify.alert("Error","<p>"+n.responseText+"<\/p>",function(){location.reload()})},""))})});$("#Role").change(function(){$(this).children("option:selected").val()=="Master Admin"?$(".mainprop").prop("hidden",!0):$(".mainprop").prop("hidden",!1)});$(document).ready(function(){$("#FilterActive").on("change",function(n){console.log("called");console.log(n);$(this).prop("checked")==!0&&($(".wofilter").show(),$(".mwofilter").show())});$(".closefilter").click(function(){$("#FilterActive").prop("checked",!1);$(".wofilter").hide(100);$(".mwofilter").hide(100)})});$("#Export").change(function(){$('input[type="submit"]').click()});$("#Cancel").click(function(){$(".pop-up").hide(100)});$(".edit-link").click(function(){$(".pop-up").show(100)});$(window).on("beforeunload",function(){isdownload?isdownload=!1:alertify.message("<div style='display:-webkit-box'>Processing &nbsp;<i style = 'display:block;' class= 'fas fa-circle-notch fa-2x fa-spin' ><\/i><\/div>",0)});$(window).on("unload",function(){this.disablespinner()});$("#LocationId").change(function(){$.get("/Property/GetSubLocation?id="+$(this).val(),function(n){if($("#SubLocationId").html("<option value=''>Select Sublocation<\/option>"),n!=null||n!=undefined)for(var t=0;t<n.length;t++)$("#SubLocationId").append("<option value="+n[t].id+">"+n[t].propertyName+"<\/option>")});$.get("GetItem?id="+$(this).val(),function(n){if($("#ItemId").html("<option value=''>Select Item<\/option>"),n!=null||n!=undefined)for(var t=0;t<n.length;t++)$("#ItemId").append("<option value="+n[t].id+">"+n[t].propertyName+"<\/option>")})});$("#ItemId").change(function(){$.get("/WorkOrder/GetIssue?id="+$(this).val(),function(n){if($("#IssueId").html("<option value=''>Select Issue<\/option><option value='-1'>Other<\/option>"),n!=null||n!=undefined)for(var t=0;t<n.length;t++)$("#IssueId").append("<option value="+n[t].id+">"+n[t].propertyName+"<\/option>")})});$("#PropertyId").change(function(){$.get("GetLocation?id="+$(this).val(),function(n){if($("#LocationId").html("<option value=''>Select Location<\/option>"),$("#SubLocationId").html("<option value=''>Select SubLocation<\/option>"),n!=null||n!=undefined)for(var t=0;t<n.length;t++)$("#LocationId").append("<option value="+n[t].id+">"+n[t].propertyName+"<\/option>")})});$("#Category").change(function(){$.get("/WorkOrder/GetDataByCategory?category="+$(this).val(),function(n){var t,i,r;if(console.log(n),n!=null||n!=undefined){$("#OptionId").html("<option value=''>Please Choose Option<\/option>");for(t in n){for(i="",t!=""&&(i+="<optgroup label='"+t+"'>"),r=0;r<n[t].length;r++)i+="<option value="+n[t][r].id+">"+n[t][r].propertyName+"<\/option>";t!=""&&(i+="<\/optgroup>");$("#OptionId").append(i)}}});$(this).val()=="department"||$(this).val()=="user"?$("#OptionId").prop("required",!0).prop("hidden",!1):$("#OptionId").removeProp("required").prop("hidden",!0)});$("#history_button").click(function(n){n.preventDefault();enablespiner();var t=$(this).data("custom-value");$.get("/WorkOrder/GetHistory?entity=workorder&rowId="+t,function(n){$("#history").html(n);disablespinner()})});$("#type-select").change(function(){EnableReqInput()});$('input[name="sub-radio"]').click(function(){EnableReqInput()});EnableReqInput();$('input[name="end-select"]').change(function(){EndInputEnabler()});EndInputEnabler();$("#RecurringStartDate").on("change",function(){$("#RecurringEndDate").prop("min",$(this).val())});isdownload=!1;$("a[name='exportlink']").click(function(){var n=this.href;event.preventDefault();alertify.confirm(this.innerText,"Export currently filtered list (all pages)?",function(){isdownload=!0;alertify.closeAll();window.location=n},function(){})});$("#IssueId").change(function(){$(this).val()=="-1"?($(".CustomIssueDiv").show(),$(".CustomIssueDiv").prop("required","true")):($(".CustomIssueDiv").hide(),$(".CustomIssueDiv").removeProp("required"))});